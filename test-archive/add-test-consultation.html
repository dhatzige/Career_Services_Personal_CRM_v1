<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Test Consultation</title>
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
        
        const supabaseUrl = 'https://oybqjspznvkhnbjmnjtp.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im95YnFqc3B6bnZraG5iam1uanRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU1ODk0NjAsImV4cCI6MjA1MTE2NTQ2MH0.5W1MmsaMzd_rHHSskcL01I_kQdqp8vxLO8pPcEuGNyQ';
        
        const supabase = createClient(supabaseUrl, supabaseAnonKey);
        
        async function addTestConsultation() {
            try {
                // Get auth session
                const { data: { session } } = await supabase.auth.getSession();
                if (!session) {
                    document.getElementById('result').innerHTML = '<p style="color: red;">Not authenticated. Please log in to the app first.</p>';
                    return;
                }
                
                // Get students first
                const { data: students, error: studentsError } = await supabase
                    .from('students')
                    .select('id, first_name, last_name')
                    .limit(1);
                
                if (studentsError || !students || students.length === 0) {
                    document.getElementById('result').innerHTML = '<p style="color: red;">No students found. Please add a student first.</p>';
                    return;
                }
                
                const student = students[0];
                
                // Add consultations for different dates and statuses
                const today = new Date();
                const consultations = [
                    {
                        student_id: student.id,
                        consultation_date: new Date(today.getTime() - 2 * 24 * 60 * 60 * 1000).toISOString(), // 2 days ago
                        consultation_type: '1-to-1 consultation',
                        duration_minutes: 30,
                        status: 'attended',
                        attended: true,
                        notes: 'Great discussion about career goals',
                        created_by: session.user.id
                    },
                    {
                        student_id: student.id,
                        consultation_date: new Date(today.getTime() - 5 * 24 * 60 * 60 * 1000).toISOString(), // 5 days ago
                        consultation_type: 'CV review',
                        duration_minutes: 45,
                        status: 'no-show',
                        attended: false,
                        notes: 'Student did not attend',
                        created_by: session.user.id
                    },
                    {
                        student_id: student.id,
                        consultation_date: new Date(today.getTime() + 2 * 24 * 60 * 60 * 1000).toISOString(), // 2 days from now
                        consultation_type: 'Interview preparation',
                        duration_minutes: 60,
                        status: 'scheduled',
                        attended: false,
                        notes: 'Upcoming mock interview session',
                        created_by: session.user.id
                    }
                ];
                
                const { data, error } = await supabase
                    .from('consultations')
                    .insert(consultations)
                    .select();
                
                if (error) {
                    console.error('Error:', error);
                    document.getElementById('result').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                    return;
                }
                
                document.getElementById('result').innerHTML = `
                    <p style="color: green;">Successfully added ${data.length} test consultations for ${student.first_name} ${student.last_name}!</p>
                    <ul>
                        <li>‚úÖ Attended consultation (2 days ago)</li>
                        <li>‚ùå No-show consultation (5 days ago)</li>
                        <li>üïê Scheduled consultation (2 days from now)</li>
                    </ul>
                    <p><strong>Now refresh the Students page to see the attendance tags!</strong></p>
                `;
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('result').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        window.addEventListener('load', () => {
            document.getElementById('addBtn').addEventListener('click', addTestConsultation);
        });
    </script>
</head>
<body>
    <h1>Add Test Consultations</h1>
    <p>This will add test consultations with different statuses to the first student in your database.</p>
    <p>Make sure you're logged in to the app and have at least one student added.</p>
    <button id="addBtn">Add Test Consultations</button>
    <div id="result" style="margin-top: 20px;"></div>
</body>
</html>